{% extends 'base.html' %}
{% block title %}サインアップ{% endblock %}
{% block content %}
<div class="text-center my-5">
    <h2>サインアップ</h2>
    {% with messages = get_flashed_messages() %}
        {% if messages %}
        {% for message in messages %}
        <p class="flash-message alert alert-danger" role="alert">{{ message }}</p>
        {% endfor %}
        {% endif %}
    {% endwith %}
</div>
<div class="container d-flex justify-content-center align-items-center" style="min-height: 50vh;">
    <form method="POST" style="width: 600px;">
        <div class="mb-3">
            <label for='userName' class="form-label">ユーザ名</label>
            <input type="text" class="form-control w-100" name="userName" id="userName"><br>
            <div class="form-text">20文字以内で入力してください。</div>
        </div>
        <div class="mb-3">
            <br><label for="password" class="form-label">パスワード</label>
            <input type="password" class="form-control w-100" name="password" id="password"><br>
        </div>

        <div class="mb-1">
            <label>年齢を選択してください</label>
            <div class="ms-5" id="age-selector">
                <div class="form-check form-check-inline">
                    <label><input class="form-check-input" type="radio" name="userAge" value="18~29(歳)" checked>18~29(歳)</label><br>
                </div><div class="form-check form-check-inline">
                    <label><input class="form-check-input" type="radio" name="userAge" value="30~49(歳)">30~49(歳)</label><br>
                </div><div class="form-check form-check-inline">
                    <label><input class="form-check-input" type="radio" name="userAge" value="50~64(歳)">50~64(歳)</label><br>
                </div><div class="form-check form-check-inline">
                    <label><input class="form-check-input" type="radio" name="userAge" value="65~74(歳)">65~74(歳)</label><br>
                </div><div class="form-check form-check-inline">
                    <label><input class="form-check-input" type="radio" name="userAge" value="75以上(歳)">75以上(歳)</label><br>
                </div>
            </div>
        </div>

        <div class="mb-1">
            <br><label>性別を選択してください</label>
            <div class="ms-5" id="gender-selector">
                <div class="form-check form-check-inline">
                    <label><input class="form-check-input" type="radio" name="userGender" value="男性" checked>男性</label><br>
                </div><div class="form-check form-check-inline">
                    <label><input class="form-check-input" type="radio" name="userGender" value="女性">女性</label><br>
                </div>
            </div>
        </div>

        <div class="mb-1">
            <br><label>運動レベルを選択してください</label>
            <div class="ms-5">
                <div class="form-check form-check-inline">
                    <label><input class="form-check-input" type="radio" name="userExerciseLevel" value="低い" checked>１日中ほとんど座っている</label><br>
                </div><div class="form-check form-check-inline">
                    <label><input class="form-check-input" type="radio" name="userExerciseLevel" value="ふつう">軽い運動・家事をしている</label><br>
                </div><div class="form-check form-check-inline">
                    <label><input class="form-check-input" type="radio" name="userExerciseLevel" value="高い">活発な運動・身体を動かす仕事をしている</label><br>
                </div>
            </div>
        </div>

        <div id="menstruation-form" class="mb-1 mt-4" style="display:none;">
            <label>生理の有無</label>
            <div class="ms-5">
                <div class="form-check form-check-inline">
                    <label><input class="form-check-input" type="radio" name="menstruation" value="あり">あり</label><br>
                </div>
                <div class="form-check form-check-inline">
                    <label><input class="form-check-input" type="radio" name="menstruation" value="なし" checked>なし</label><br>
                </div>
            </div>
        </div>

        <div class="text-center mt-5">
            <button type="submit" class="btn btn-info btn-lg w-50">サインアップ</button>
        </div>
    </form>
</div>
<script>
function updateMenstruationForm() {
    const ageRadios = document.querySelectorAll('input[name="userAge"]');
    const genderRadios = document.querySelectorAll('input[name="userGender"]');

    let selectedAge = null;
    let selectedGender = null;

    ageRadios.forEach(r => { if(r.checked) selectedAge = r.value; });
    genderRadios.forEach(r => { if(r.checked) selectedGender = r.value; });

    const form = document.getElementById('menstruation-form');

    if (selectedGender === '女性' && ['18~29(歳)', '30~49(歳)', '50~64(歳)'].includes(selectedAge)) {
        form.style.display = 'block';
    } else {
        form.style.display = 'none';
        form.querySelector('input[value="なし"]').checked = true;
    }
}

// ラジオ変更時
document.querySelectorAll('input[name="userAge"], input[name="userGender"]').forEach(r => {
    r.addEventListener('change', updateMenstruationForm);
});

// ページロード時
window.addEventListener('load', updateMenstruationForm);
</script>
{% endblock %}
