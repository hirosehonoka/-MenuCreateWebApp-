{% extends 'base.html' %}
{% block title %}ユーザの更新{% endblock %}
{% block content %}
<div class="d-flex justify-content-center">
  <div style="min-width:340px;">
    <div class="text-center my-5">
      <h2>ユーザの更新</h2>
    </div>
    <div class="mx-5">
      <form method="POST">
        <div class="ms-3">
          <br><legend>年齢を選択してください</legend>
          <div class="ms-5">
            <div class="form-check form-check-inline">
              <label>
                <input class="form-check-input" type="radio" name="userAge" value="18~29(歳)" {% if userAge_selected == "18~29(歳)" %}checked{% endif %}>18~29(歳)
              </label><br>
            </div>
            <div class="form-check form-check-inline">
              <label>
                <input class="form-check-input" type="radio" name="userAge" value="30~49(歳)" {% if userAge_selected == "30~49(歳)" %}checked{% endif %}>30~49(歳)
              </label><br>
            </div>
            <div class="form-check form-check-inline">
              <label>
                <input class="form-check-input" type="radio" name="userAge" value="50~64(歳)" {% if userAge_selected == "50~64(歳)" %}checked{% endif %}>50~64(歳)
              </label><br>
            </div>
            <div class="form-check form-check-inline">
              <label>
                <input class="form-check-input" type="radio" name="userAge" value="65~74(歳)" {% if userAge_selected == "65~74(歳)" %}checked{% endif %}>65~74(歳)
              </label><br>
            </div>
            <div class="form-check form-check-inline">
              <label>
                <input class="form-check-input" type="radio" name="userAge" value="75以上(歳)" {% if userAge_selected == "75以上(歳)" %}checked{% endif %}>75以上(歳)
              </label><br>
            </div>
          </div>
        </div>

        <div class="ms-3">
          <br><legend>運動レベルを選択してください</legend>
          <div class="ms-5">
            <div class="form-check form-check-inline">
              <label>
                <input class="form-check-input" type="radio" name="userExerciseLevel" value="低い" {% if userExerciseLevel_selected == "低い" %}checked{% endif %}>１日中ほとんど座っている
              </label><br>
            </div>
            <div class="form-check form-check-inline">
              <label>
                <input class="form-check-input" type="radio" name="userExerciseLevel" value="ふつう" {% if userExerciseLevel_selected == "ふつう" %}checked{% endif %}>軽い運動・家事をしている
              </label><br>
            </div>
            <div class="form-check form-check-inline">
              <label>
                <input class="form-check-input" type="radio" name="userExerciseLevel" value="高い" {% if userExerciseLevel_selected == "高い" %}checked{% endif %}>活発な運動・身体を動かす仕事をしている
              </label><br>
            </div>
          </div>
        </div>

        <div class="ms-3 mt-4" id="menstruation-form" style="display:none;">
            <legend>生理の有無</legend>
            <div class="form-check form-check-inline ms-5">
                <label>
                    <input class="form-check-input" type="radio" name="menstruation" value="あり"
                    {% if menstruation_selected == 'あり' %}checked{% endif %}> あり
                </label>
            </div>
            <div class="form-check form-check-inline">
                <label>
                    <input class="form-check-input" type="radio" name="menstruation" value="なし"
                    {% if menstruation_selected == 'なし' %}checked{% endif %}> なし
                </label><br>
            </div>
        </div>

        <div class="text-center my-5">
          <button type="submit" class="btn btn-primary w-50">更新</button>
        </div>
      </form>
    </div>
  </div>
</div>
<script>
const selectedGender = "{{ userGender_selected }}";  // Flask から渡す性別

function updateMenstruationForm() {
    const ageRadios = document.querySelectorAll('input[name="userAge"]');
    let selectedAge = null;

    ageRadios.forEach(r => { if(r.checked) selectedAge = r.value; });

    const form = document.getElementById('menstruation-form');
    if (selectedGender === '女性' && ['18~29(歳)', '30~49(歳)', '50~64(歳)'].includes(selectedAge)) {
        form.style.display = 'block';
    } else {
        form.style.display = 'none';
        form.querySelector('input[value="なし"]').checked = true;
    }
}

// 年齢ラジオ変更時
document.querySelectorAll('input[name="userAge"]').forEach(r => {
    r.addEventListener('change', updateMenstruationForm);
});

// ページロード時
window.addEventListener('load', updateMenstruationForm);
</script>
{% endblock %}